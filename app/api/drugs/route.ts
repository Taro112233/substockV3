
// üìÑ File: app/api/drugs/route.ts (FIXED TypeScript Strict)
// API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç TypeScript errors

import { NextRequest, NextResponse } from "next/server";
import { prisma } from "@/lib/prisma";
import { verifyToken } from "@/lib/auth";
import { z, ZodError, ZodIssue } from "zod";
import { Prisma } from "@prisma/client";

// Schema ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö validation ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà
const createDrugSchema = z.object({
  hospitalDrugCode: z
    .string()
    .min(1, "‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô")
    .max(50, "‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 50 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"),
  name: z
    .string()
    .min(1, "‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô")
    .max(255, "‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 255 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"),
  genericName: z
    .string()
    .max(255, "‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏°‡∏±‡∏ç‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 255 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£")
    .nullable()
    .optional(),
  dosageForm: z.enum(
    [
      "APP", "BAG", "CAP", "CR", "DOP", "ENE", "GEL", "HAN", "IMP",
      "INJ", "LIQ", "LOT", "LVP", "MDI", "MIX", "NAS", "NB", "OIN",
      "PAT", "POW", "PWD", "SAC", "SOL", "SPR", "SUP", "SUS", "SYR",
      "TAB", "TUR",
    ],
    {
      message: "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
    }
  ),
  strength: z
    .string()
    .max(50, "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 50 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£")
    .nullable()
    .optional(),
  unit: z
    .string()
    .min(1, "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô")
    .max(20, "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"),
  packageSize: z
    .string()
    .max(50, "‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 50 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£")
    .nullable()
    .optional(),
  pricePerBox: z
    .number()
    .min(0, "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 0")
    .max(999999.99, "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 999,999.99"),
  category: z.enum(
    [
      "REFER", "HAD", "NARCOTIC", "REFRIGERATED", "PSYCHIATRIC",
      "FLUID", "GENERAL", "TABLET", "SYRUP", "INJECTION", "EXTEMP", "ALERT",
    ],
    {
      message: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏¢‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
    }
  ),
  notes: z
    .string()
    .max(1000, "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£")
    .nullable()
    .optional(),
  // Stock data
  department: z.enum(["PHARMACY", "OPD"], { message: "‡πÅ‡∏ú‡∏ô‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" }),
  initialQuantity: z.number().min(0, "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 0"),
  minimumStock: z.number().min(0, "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 0"),
});

// GET - ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö search/autocomplete)
export async function GET(request: NextRequest) {
  try {
    // Verify authentication
    const token =
      request.headers.get("authorization")?.replace("Bearer ", "") ||
      request.cookies.get("auth-token")?.value;

    if (!token) {
      return NextResponse.json(
        { error: "‡πÑ‡∏°‡πà‡∏û‡∏ö token ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" },
        { status: 401 }
      );
    }

    const decoded = await verifyToken(token);
    if (!decoded) {
      return NextResponse.json({ error: "Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" }, { status: 401 });
    }

    // Get query parameters
    const searchParams = request.nextUrl.searchParams;
    const search = searchParams.get("search");
    const category = searchParams.get("category");
    const dosageForm = searchParams.get("dosageForm");
    const isActive = searchParams.get("active") !== "false";

    // ‚úÖ Fixed: ‡πÉ‡∏ä‡πâ Prisma.DrugWhereInput ‡πÅ‡∏ó‡∏ô any
    const where: Prisma.DrugWhereInput = {
      isActive,
    };

    if (search) {
      where.OR = [
        { name: { contains: search, mode: "insensitive" } },
        { hospitalDrugCode: { contains: search, mode: "insensitive" } },
        { genericName: { contains: search, mode: "insensitive" } },
      ];
    }

    if (category) {
      // ‚úÖ Fixed: ‡πÉ‡∏ä‡πâ proper enum type
      where.category = category as Prisma.EnumDrugCategoryFilter;
    }

    if (dosageForm) {
      // ‚úÖ Fixed: ‡πÉ‡∏ä‡πâ proper enum type
      where.dosageForm = dosageForm as Prisma.EnumDosageFormFilter;
    }

    const drugs = await prisma.drug.findMany({
      where,
      include: {
        stocks: {
          select: {
            id: true,
            department: true,
            totalQuantity: true,
            minimumStock: true,
            totalValue: true,
          },
        },
        _count: {
          select: {
            transferItems: true,
          },
        },
      },
      orderBy: [{ name: "asc" }],
      take: 100, // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
    });

    return NextResponse.json({
      success: true,
      data: drugs,
    });
  } catch (error) {
    console.error("Get drugs error:", error);
    return NextResponse.json(
      { error: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤" },
      { status: 500 }
    );
  }
}

// POST - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
export async function POST(request: NextRequest) {
  try {
    // Verify authentication
    const token =
      request.headers.get("authorization")?.replace("Bearer ", "") ||
      request.cookies.get("auth-token")?.value;

    if (!token) {
      return NextResponse.json(
        { error: "‡πÑ‡∏°‡πà‡∏û‡∏ö token ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" },
        { status: 401 }
      );
    }

    const decoded = await verifyToken(token);
    if (!decoded) {
      return NextResponse.json({ error: "Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" }, { status: 401 });
    }

    // Get and validate input data
    const body = await request.json();
    const validatedData = createDrugSchema.parse(body);

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const existingDrugByCode = await prisma.drug.findFirst({
      where: {
        hospitalDrugCode: validatedData.hospitalDrugCode,
      },
    });

    if (existingDrugByCode) {
      return NextResponse.json(
        {
          error: "‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß",
        },
        { status: 400 }
      );
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const existingDrugByName = await prisma.drug.findFirst({
      where: {
        name: validatedData.name,
      },
    });

    if (existingDrugByName) {
      return NextResponse.json(
        {
          error: "‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß",
        },
        { status: 400 }
      );
    }

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    const initialTotalValue =
      validatedData.initialQuantity * validatedData.pricePerBox;

    // ‡πÉ‡∏ä‡πâ transaction ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
    const result = await prisma.$transaction(async (tx) => {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà
      const newDrug = await tx.drug.create({
        data: {
          hospitalDrugCode: validatedData.hospitalDrugCode,
          name: validatedData.name,
          genericName: validatedData.genericName,
          dosageForm: validatedData.dosageForm,
          strength: validatedData.strength,
          unit: validatedData.unit,
          packageSize: validatedData.packageSize,
          pricePerBox: validatedData.pricePerBox,
          category: validatedData.category,
          notes: validatedData.notes,
          isActive: true,
        },
      });

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡πÅ‡∏ú‡∏ô‡∏Å
      const primaryDepartment = validatedData.department;
      const secondaryDepartment =
        validatedData.department === "PHARMACY" ? "OPD" : "PHARMACY";

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
      const primaryStock = await tx.stock.create({
        data: {
          drugId: newDrug.id,
          department: primaryDepartment,
          totalQuantity: validatedData.initialQuantity,
          reservedQty: 0,
          minimumStock: validatedData.minimumStock,
          fixedStock: 0,
          totalValue: initialTotalValue,
        },
      });

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏£‡∏≠‡∏á (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 0)
      const secondaryStock = await tx.stock.create({
        data: {
          drugId: newDrug.id,
          department: secondaryDepartment,
          totalQuantity: 0,
          reservedQty: 0,
          minimumStock: 0,
          fixedStock: 0,
          totalValue: 0,
        },
      });

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å transaction log ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
      if (validatedData.initialQuantity > 0) {
        await tx.stockTransaction.create({
          data: {
            stockId: primaryStock.id,
            userId: decoded.userId,
            type: "RECEIVE_EXTERNAL",
            quantity: validatedData.initialQuantity,
            beforeQty: 0,
            afterQty: validatedData.initialQuantity,
            unitCost: validatedData.pricePerBox,
            totalCost: initialTotalValue,
            reference: `INITIAL_STOCK_${Date.now()}`,
            note: `‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏ú‡∏ô‡∏Å ${primaryDepartment})`,
          },
        });
      }

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å transaction log ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏£‡∏≠‡∏á (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 0)
      await tx.stockTransaction.create({
        data: {
          stockId: secondaryStock.id,
          userId: decoded.userId,
          type: "ADJUST_INCREASE",
          quantity: 0,
          beforeQty: 0,
          afterQty: 0,
          unitCost: validatedData.pricePerBox,
          totalCost: 0,
          reference: `INITIAL_STOCK_${Date.now()}`,
          note: `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å ${secondaryDepartment} (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 0)`,
        },
      });

      // ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• primary stock ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö frontend
      return {
        ...primaryStock,
        drug: {
          ...newDrug,
          stocks: [primaryStock, secondaryStock],
        },
      };
    });

    const secondaryDepartment =
      validatedData.department === "PHARMACY" ? "OPD" : "PHARMACY";

    return NextResponse.json({
      success: true,
      data: result,
      message: `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤ "${validatedData.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à | ${
        validatedData.department
      }: ${validatedData.initialQuantity.toLocaleString()} ‡∏Å‡∏•‡πà‡∏≠‡∏á (minimum: ${validatedData.minimumStock}) | ${secondaryDepartment}: 0 ‡∏Å‡∏•‡πà‡∏≠‡∏á (minimum: 0)`,
      details: {
        primaryDepartment: validatedData.department,
        primaryQuantity: validatedData.initialQuantity,
        primaryMinimumStock: validatedData.minimumStock,
        secondaryDepartment:
          validatedData.department === "PHARMACY" ? "OPD" : "PHARMACY",
        secondaryQuantity: 0,
        secondaryMinimumStock: 0,
        totalStocks: 2,
      },
    });
  } catch (error) {
    console.error("Create drug error:", error);

    // ‚úÖ Fixed: Type-safe error handling
    if (error instanceof ZodError) {
      return NextResponse.json(
        {
          error: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
          details: error.issues
            .map((issue: ZodIssue) => `${issue.path.join(".")}: ${issue.message}`)
            .join(", "),
        },
        { status: 400 }
      );
    }

    // Handle Prisma unique constraint errors
    if (error instanceof Prisma.PrismaClientKnownRequestError) {
      if (error.code === "P2002") {
        // ‚úÖ Fixed: Type-safe meta target access
        const target = error.meta?.target;
        const field = Array.isArray(target) ? target[0] : undefined;
        let message = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß";

        if (field === "hospitalDrugCode") {
          message = "‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
        } else if (field === "name") {
          message = "‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
        }

        return NextResponse.json({ error: message }, { status: 400 });
      }
    }

    // Generic error handling
    return NextResponse.json(
      { error: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà" },
      { status: 500 }
    );
  }
}