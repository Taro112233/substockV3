// prisma/schemas/drug.prisma
// ===== 3. DRUG MASTER SCHEMA =====

// Enhanced Drug Model with Hospital-specific Data and Enums
model Drug {
  id              String       @id @default(cuid())
  hospitalDrugCode String      @unique // รหัสยาเฉพาะโรงพยาบาล
  name            String       // ชื่อยาทางการค้า
  genericName     String?      // ชื่อสามัญยา
  dosageForm      DosageForm   // รูปแบบยา (enum)
  strength        String?      // ความแรงยา (500, 250)
  unit            String       // หน่วยนับ (mg, g, mg/5ml)
  packageSize     String?      // ขนาดบรรจุ (100's, 500)
  pricePerBox     Float        @default(0) // ราคาต่อกล่อง/หน่วย
  category        DrugCategory @default(GENERAL) // หมวดหมู่ยา (enum)
  isActive        Boolean      @default(true)
  notes           String?      // หมายเหตุเพิ่มเติม
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  // Relations
  stocks          Stock[]
  transferItems   TransferItem[]
  batches         DrugBatch[]
  
  // Indexes สำหรับ Performance
  @@index([hospitalDrugCode])
  @@index([name])
  @@index([category])
  @@index([dosageForm])
  @@index([isActive])
  @@index([genericName])
  @@map("drugs")
}

// Drug Batch Management (LOT/EXPIRY)
model DrugBatch {
  id            String   @id @default(cuid())
  drugId        String
  department    Department
  lotNumber     String
  expiryDate    DateTime
  manufacturer  String?
  quantity      Int      @default(0)
  costPerUnit   Float    @default(0)
  receivedDate  DateTime @default(now())
  
  // Relations
  drug          Drug     @relation(fields: [drugId], references: [id], onDelete: Cascade)
  transactions  StockTransaction[]
  
  // Constraints
  @@unique([drugId, department, lotNumber, expiryDate])
  
  // Indexes
  @@index([expiryDate])
  @@index([department])
  @@index([drugId])
  @@map("drug_batches")
}